from typing import List
import math
class Solution:
    def resultGrid(self, image: List[List[int]], threshold: int) -> List[List[int]]:
        n = len(image)
        m = len(image[0])
        grid = []
        def getMax(s_i,s_j, e_i,e_j):
            _max = -1
            if s_i + 1 <= e_i:
                _max = max(_max, abs(image[s_i][s_j]-image[s_i+1][s_j]), getMax(s_i+1, s_j,  e_i,e_j))
            if s_j + 1 <= e_j:
                _max = max(_max, abs(image[s_i][s_j]-image[s_i][s_j+1]), getMax(s_i, s_j+1,  e_i,e_j))
            return _max 
        for i in range(n-2):
            grid.append([])
            for j in range(m-2):
                sum = 0
                _max = getMax(i,j,i+2,j+2)
                for k in range(i, i+3):
                    for l in range(j,j+3):
                        sum += image[k][l]
                if _max <= threshold:
                    grid[-1].append(math.floor(sum / 9))
                else:
                    grid[-1].append(-1)
        result = []
        for i in range(n):
            result.append([])
            for j in range(m):
                count = 0
                sum = 0
                # 0 to 2
                for k in range(3):
                    for l in range(3):
                      if i - k >= 0 and j - l >= 0 and i - k < n - 2 and j-l < m - 2:
                          if(grid[i-k][j-l]>=0):
                              count += 1
                              sum += grid[i-k][j-l]
                if count > 0:
                    result[-1].append(math.floor(sum/count))
                else:
                    result[-1].append(image[i][j])
        return result


# a = Solution()
# print(a.resultGrid([[5,6,7,10],[8,9,10,10],[11,12,13,10]], 3))

x = [[1,1,1,1,1,1,1,1,1,1,2,3,3,3,1,2,2,3,2,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,2,3,3,3,1,2,2,3,2,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,2,3,3,3,1,2,2,3,2,1,1,1,1,1,1],[0,0,0,0,0,0,0,0,0,1,2,3,2,2,1,1,2,2,2,1,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,1,1,2,2,2,1,1,1,2,1,1,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,1,1,2,2,2,1,1,1,2,1,1,0,0,0,0,0],[1,1,1,1,1,1,1,1,1,2,3,4,3,3,2,2,3,3,3,2,1,1,1,1,1],[3,3,3,3,3,3,3,3,3,3,4,5,5,5,3,4,4,5,4,3,3,3,3,3,3],[4,4,4,4,4,4,4,4,4,4,5,6,6,6,4,5,5,6,5,4,4,4,4,4,4],[5,5,5,5,5,5,5,5,5,5,6,7,7,7,5,6,6,7,6,5,5,5,5,5,5],[6,6,6,6,6,6,6,6,6,6,7,8,8,8,6,7,7,8,7,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,6,7,7,8,8,8,7,7,7,8,7,7,6,6,6,6,6],[4,4,4,4,4,4,4,4,4,4,5,6,6,5,4,5,5,6,5,4,4,4,4,4,4],[1,1,1,1,1,1,1,1,1,2,3,4,3,3,2,2,3,3,3,2,1,1,1,1,1],[0,0,0,0,0,0,1,0,0,0,1,2,2,1,0,1,1,2,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,1,2,2,1,0,1,1,2,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,1,2,2,1,0,1,1,2,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,1,2,2,1,0,1,1,2,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,1,2,3,3,2,1,1,2,3,2,1,0,0,0,0,0],[1,1,1,1,1,1,2,1,1,2,3,4,4,3,2,2,3,4,3,2,1,1,1,1,1],[2,2,2,2,2,2,3,2,2,3,4,5,5,4,3,3,4,5,4,3,2,2,2,2,2],[1,1,1,1,1,1,2,1,1,2,3,4,4,3,2,2,3,4,3,2,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,2,3,3,2,1,2,2,3,2,1,1,1,1,1,1],[0,0,0,0,0,0,1,0,0,0,1,2,2,2,0,1,1,2,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,1,2,2,2,0,1,1,2,1,0,0,0,0,0,0]]
y = [[1,1,1,1,1,1,1,1,1,1,2,3,3,3,1,2,2,3,2,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,2,3,3,3,1,2,2,3,2,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,2,3,3,3,1,2,2,3,2,1,1,1,1,1,1],[0,0,0,0,0,0,0,0,0,1,2,3,2,2,1,1,2,2,2,1,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,1,1,2,2,2,1,1,1,2,1,1,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,1,1,2,2,2,1,1,1,2,1,1,0,0,0,0,0],[1,1,1,1,1,1,1,1,1,2,3,4,3,3,2,2,3,3,3,2,1,1,1,1,1],[3,3,3,3,3,3,3,3,3,3,4,5,5,5,3,4,4,5,4,3,3,3,3,3,3],[4,4,4,4,4,4,4,4,4,4,5,6,6,6,4,5,5,6,5,4,4,4,4,4,4],[5,5,5,5,5,5,5,5,5,5,6,7,7,7,5,6,6,7,6,5,5,5,5,5,5],[6,6,6,6,6,6,6,6,6,6,7,8,8,8,6,7,7,8,7,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,6,7,7,8,8,8,7,7,7,8,7,7,6,6,6,6,6],[4,4,4,4,4,4,4,4,4,4,5,6,6,5,4,5,5,6,5,4,4,4,4,4,4],[1,1,1,1,1,1,1,1,1,2,3,4,3,3,2,2,3,3,3,2,1,1,1,1,1],[0,0,0,0,0,0,0,0,0,0,1,2,2,1,0,1,1,2,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,1,2,2,1,0,1,1,2,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,1,2,2,1,0,1,1,2,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,1,2,2,1,0,1,1,2,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,1,2,3,3,2,1,1,2,3,2,1,0,0,0,0,0],[1,1,1,1,1,1,2,1,1,2,3,4,4,3,2,2,3,4,3,2,1,1,1,1,1],[2,2,2,2,2,2,3,2,2,3,4,5,5,4,3,3,4,5,4,3,2,2,2,2,2],[1,1,1,1,1,1,2,1,1,2,3,4,4,3,2,2,3,4,3,2,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,2,3,3,2,1,2,2,3,2,1,1,1,1,1,1],[0,0,0,0,0,0,0,0,0,0,1,2,2,2,0,1,1,2,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,1,2,2,2,0,1,1,2,1,0,0,0,0,0,0]]
for i in range(len(x)):
    for j in range(len(x[0])):
        if (x[i][j] != y[i][j]):
            print(i,j,x[i][j],y[i][j])